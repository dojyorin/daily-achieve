<!doctype html>
<meta charset="utf-8">
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="height=device-height,width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no">

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50%' y='50%' style='dominant-baseline:central;text-anchor:middle;font-size:100px;'>üö•</text></svg>">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@3/dist/vuetify.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7/css/materialdesignicons.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=M+PLUS+1+Code:wght@100;200;300;400;500;600;700">

<script type="importmap">
    {
        "imports": {
            "vue": "https://cdn.jsdelivr.net/npm/vue@3/dist/vue.esm-browser.prod.min.js",
            "@vue/devtools-api": "https://cdn.jsdelivr.net/npm/@vue/devtools-api@6/lib/esm/index.min.js"
        }
    }
</script>

<script async type="module">
    import {createApp, defineComponent, ref, reactive, inject, computed} from "https://cdn.jsdelivr.net/npm/vue@3/dist/vue.esm-browser.prod.min.js";
    import {createRouter, createWebHashHistory, useRouter} from "https://cdn.jsdelivr.net/npm/vue-router@4/dist/vue-router.esm-browser.min.js";
    import {createVuetify, useDisplay, useLayout} from "https://cdn.jsdelivr.net/npm/vuetify@3/dist/vuetify.esm.min.js";

    import {Dexie} from "https://esm.sh/dexie@3.2.6?bundle&target=esnext";
    import {Chart} from "https://esm.sh/chart.js@4.4.1?bundle&target=esnext";
    import confetti from "https://esm.sh/canvas-confetti@1.9.2?bundle&target=esnext";
    import {} from "https://esm.sh/gh/dojyorin/deno_simple_utility@v2.0.6/mod.pure.full.ts?bundle&target=esnext";

    const sfc_common_reflect = defineComponent({
        template: /*html*/`
            <div>
                <slot></slot>
            </div>
        `
    });

    const sfc_layout_main_header = defineComponent({
        template: /*html*/`
            <v-app-bar density="compact" class="text-white">
                <v-app-bar-nav-icon @click="nav = !nav"></v-app-bar-nav-icon>
                <v-app-bar-title class="text-h5">„Éá„Ç§„É™„Éº„Ç¢„ÉÅ„Éº„Éñ</v-app-bar-title>

                <template #image>
                    <v-img gradient="45deg, #174AFF, #0ECDFF"></v-img>
                </template>
            </v-app-bar>
        `,
        setup(){
            const nav = inject("@layout:navigation");

            return {nav};
        }
    });

    const sfc_layout_main_loading = defineComponent({
        template: /*html*/`
            <v-overlay persistent no-click-animation z-index="4000" class="justify-center align-center" v-model="loading">
                <v-progress-circular indeterminate size="60" width="4" color="primary"></v-progress-circular>
            </v-overlay>
        `,
        setup(){
            const loading = inject("@layout:loading");

            return {loading};
        }
    });

    const sfc_layout_main_navigation = defineComponent({
        template: /*html*/`
            <v-navigation-drawer floating temporary v-model="nav">
                <v-toolbar density="compact" color="transparent">
                    <v-btn icon="mdi-close" @click="nav = false"></v-btn>
                </v-toolbar>

                <v-list nav density="compact">
                    <v-list-item v-for="{path, name} in routes" :to="path">
                        <v-list-item-title>{{name}}</v-list-item-title>
                    </v-list-item>
                </v-list>

                <template #append>
                    <v-btn block target="_blank" href="https://github.com/dojyorin/daily-achieve" rounded="0" prepend-icon="mdi-github">GitHub</v-btn>
                </template>
            </v-navigation-drawer>
        `,
        setup(){
            const router = useRouter();

            const nav = inject("@layout:navigation");

            const routes = router.options.routes.filter(({path}) => !/:/.test(path));

            return {nav, routes};
        }
    });

    const sfc_layout_main_notify = defineComponent({
        template: /*html*/`
            <v-snackbar v-for="notify in notifies" model-value position="fixed" location="top" z-index="3000" :color="notify.color" timeout="-1" v-bind="notifyTimeout(notify, 5000)">
                <div>{{notify.message}}</div>

                <template #actions>
                    <v-btn ripple density="comfortable" icon="mdi-close" @click="notifyTimeout(notify, 0)"></v-btn>
                </template>
            </v-snackbar>
        `,
        setup(){
            const notifies = inject("@layout:notify");

            async function notifyTimeout(notify, ms){
                await new Promise(done => setTimeout(done, ms));

                const i = notifies.findIndex(v => v === notify);

                if(i === -1){
                    return;
                }

                notifies.splice(i, 1);
            }

            return {notifies, notifyTimeout};
        }
    });

    const sfc_layout_main = defineComponent({
        template: /*html*/`
            <v-app>
                <x-loading></x-loading>
                <x-notify></x-notify>
                <x-navigation></x-navigation>
                <x-header></x-header>
                <v-main>
                    <router-view></router-view>
                </v-main>
            </v-app>
        `,
        components: {
            "x-loading": sfc_layout_main_loading,
            "x-notify": sfc_layout_main_notify,
            "x-navigation": sfc_layout_main_navigation,
            "x-header": sfc_layout_main_header
        }
    });

    const sfc_page_home = defineComponent({
        template: /*html*/`
            <v-container fluid>
                <v-row no-gutters justify="center">
                    <v-col cols sm="8" md="4">
                        <v-list>
                            <template v-for="(achieve, i) in achieves">
                                <v-divider v-if="i"></v-divider>
                                <v-list-item>
                                    <v-list-title v-if="!achieve._edit">{{achieve.name || "(Êú™Ë®≠ÂÆö)"}}</v-list-title>
                                    <v-text-field v-else single-line variant="underlined" v-model="achieve.name"></v-text-field>

                                    <template #append>
                                        <v-btn v-if="achieve._edit" :disabled="i === 0" flat color="transparent" density="comfortable" icon="mdi-menu-up-outline" @click="achieves.splice(i - 1, 2, achieves[i], achieves[i - 1])"></v-btn>
                                        <v-btn v-if="achieve._edit" :disabled="i + 1 === achieves.length" flat color="transparent" density="comfortable" icon="mdi-menu-down-outline" @click="achieves.splice(i, 2, achieves[i + 1], achieves[i])"></v-btn>
                                        <v-btn :disabled="achieves.some(({_edit}) => _edit) && !achieve._edit" flat color="transparent" density="comfortable" :icon="achieve._edit ? 'mdi-text-box-check-outline' : 'mdi-text-box-edit-outline'" @click="achieve._edit = !achieve._edit"></v-btn>
                                    </template>
                                </v-list-item>
                            </template>
                        </v-list>
                        <v-rating hover length="10" active-color="pink" v-model="energy"></v-rating>
                        <v-textarea placeholder="„Å≤„Å®„Åì„Å®Êó•Ë®ò"></v-textarea>
                        <v-btn @click="debugLog(achieves, energy)">debug</v-btn>
                    </v-col>
                </v-row>
            </v-container>
        `,
        setup(){
            const notifies = inject("@layout:notify");
            const achieves = inject("@achieves");
            const energy = inject("@energy");

            function debugLog(...v){
                console.log(...v);
                confetti();
            }

            return {achieves, energy, debugLog};
        }
    });

    const sfc_page_graph = defineComponent({
        template: /*html*/`
            <v-container fluid>
                <v-row no-gutters justify="center">
                    <v-col cols sm="8" md="4">
                        <v-row>
                            <v-col cols>
                                <v-card>
                                    <v-card-title>„Ç∞„É©„Éï</v-card-title>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-col>
                </v-row>
            </v-container>
        `
    });

    const sfc_page_config = defineComponent({
        template: /*html*/`
            <v-container fluid>
                <v-row no-gutters justify="center">
                    <v-col cols sm="8" md="4">
                        <v-row>
                            <v-col cols>
                                <v-card>
                                    <v-card-title>Ë®≠ÂÆö</v-card-title>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-col>
                </v-row>
            </v-container>
        `
    });

    const sfc_page_backup = defineComponent({
        template: /*html*/`
            <v-container fluid>
                <v-row no-gutters justify="center">
                    <v-col cols sm="8" md="4">
                        <v-row>
                            <v-col cols>
                                <v-card>
                                    <v-card-title>„Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</v-card-title>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-col>
                </v-row>
            </v-container>
        `
    });

    const sfc_page_about = defineComponent({
        template: /*html*/`
            <v-container fluid>
                <v-row no-gutters justify="center">
                    <v-col cols sm="8" md="4">
                        <v-row>
                            <v-col cols>
                                <v-card>
                                    <v-card-title>„Åì„ÅÆ„Ç¢„Éó„É™„Å´„Å§„ÅÑ„Å¶</v-card-title>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-col>
                </v-row>
            </v-container>
        `
    });

    const router = createRouter({
        history: createWebHashHistory(),
        routes: [{
            path: "/",
            name: "„Éõ„Éº„É†",
            component: sfc_page_home
        }, {
            path: "/graph",
            name: "„Ç∞„É©„Éï",
            component: sfc_page_graph
        }, {
            path: "/config",
            name: "Ë®≠ÂÆö",
            component: sfc_page_config
        }, {
            path: "/backup",
            name: "„Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó",
            component: sfc_page_backup
        }, {
            path: "/about",
            name: "„Åì„ÅÆ„Ç¢„Éó„É™„Å´„Å§„ÅÑ„Å¶",
            component: sfc_page_about
        }, {
            path: "/:catchAll(.*)",
            redirect: "/"
        }]
    });

    const vuetify = createVuetify({
        theme: {
            defaultTheme: "main",
            themes: {
                "main": {
                    dark: false,
                    colors: {
                        primary: "#03A9F4",
                        secondary: "#9C27B0",
                        surface: "#FFFFFF",
                        background: "#FFFFFF",
                        info: "#2196F3",
                        success: "#4CAF50",
                        warning: "#FFC107",
                        error: "#FF5252"
                    }
                }
            }
        }
    });

    const component = {
        install(context){
            context.component("x-reflect", sfc_common_reflect);
        }
    };

    const provide = {
        install(context){
            context.provide("@layout:navigation", ref(false));
            context.provide("@layout:loading", ref(false));
            context.provide("@layout:notify", reactive([]));

            context.provide("@achieves", reactive([...new Array(10)].map(() => ({name: "", _edit: false}))));
            context.provide("@energy", ref(0));
        }
    };

    const vue = createApp(sfc_layout_main);

    vue.use(router);
    vue.use(vuetify);
    vue.use(component);
    vue.use(provide);

    vue.mount("#vue");
</script>

<style>
    ::-webkit-scrollbar {
        display: none !important;
    }

    :focus {
        outline: none !important;
    }

    * {
        font-family: "M PLUS 1 Code" !important;
    }

    .v-btn {
        text-transform: none !important;
        letter-spacing: normal !important;
        text-indent: 0 !important;
    }
</style>

<title>„Éá„Ç§„É™„Éº„Ç¢„ÉÅ„Éº„Éñ</title>

<div id="vue"></div>